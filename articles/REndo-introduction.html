<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>REndo: A Package to Address Endogeneity Without External Instrumental Variables • REndo</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="REndo: A Package to Address Endogeneity Without External Instrumental Variables">
<meta property="og:description" content="REndo">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]--><!-- Global site tag (gtag.js) - Google Analytics --><script async src="https://www.googletagmanager.com/gtag/js?id=UA-31477052-1"></script><script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'UA-31477052-1');
</script>
</head>
<body data-spy="scroll" data-target="#toc">
    

    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">REndo</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="">2.4.5</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/REndo-introduction.html">REndo: A Package to Address Endogeneity Without External Instrumental Variables</a>
    </li>
  </ul>
</li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/mmeierer/REndo/" class="external-link">
    <span class="fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><script src="REndo-introduction_files/accessible-code-block-0.0.1/empty-anchor.js"></script><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>REndo: A Package to Address Endogeneity Without External Instrumental Variables</h1>
                        <h4 data-toc-skip class="author">Raluca Gui</h4>
            
            <h4 data-toc-skip class="date">2022-07-10</h4>
      
      <small class="dont-index">Source: <a href="https://github.com/mmeierer/REndo/blob/HEAD/vignettes/REndo-introduction.Rmd" class="external-link"><code>vignettes/REndo-introduction.Rmd</code></a></small>
      <div class="hidden name"><code>REndo-introduction.Rmd</code></div>

    </div>

    
    
<div class="section level2">
<h2 id="what-does-rendo-do">1. What does REndo do<a class="anchor" aria-label="anchor" href="#what-does-rendo-do"></a>
</h2>
<p><strong>REndo</strong> is the first <strong>R</strong> package to implement the most recent <em>internal instrumental variable</em> methods to address endogeneity. The package includes implementations of the latent instrumental variable approach (Ebbes et al., 2005), the joint estimation using copula (Park and Gupta, 2012), the higher moments method (Lewbel, 1997) and the heteroskedastic error approach (Lewbel, 2012). To model hierarchical data (not cross-classified) such as students nested within classrooms, nested within schools, <strong>REndo</strong> includes the multilevel GMM estimation proposed by Kim and Frees (2007). All approaches assume a <strong>continuous dependent variable</strong>.</p>
<p><strong>Internal instrumental variable</strong> approaches, also called <strong>instrument free methods</strong>, have been proposed as alternative to external instrumental variable approaches (like IV regression) to address endogeneity concerns, when valid, strong instruments are difficult to find.</p>
<p>The only alternative to <strong>REndo</strong> we could find in <strong>R</strong> is the <strong>ivlewbel</strong> package that implements the heteroskedastic errors method proposed by Lewbel (2012).</p>
</div>
<div class="section level2">
<h2 id="short-description-of-rendos-functions">2. Short Description of REndo’s Functions<a class="anchor" aria-label="anchor" href="#short-description-of-rendos-functions"></a>
</h2>
<div class="section level3">
<h3 id="instrument-free-methods-for-non-hierarchical-data">2.1 Instrument Free Methods for Non-hierarchical Data<a class="anchor" aria-label="anchor" href="#instrument-free-methods-for-non-hierarchical-data"></a>
</h3>
<p>The four instrument free methods presented in this section share the same underlying model presented in equations (1) and (2) below. The specific characteristics of each method are discussed in the subsequent sections.</p>
<p>Consider the model:</p>
<p><span class="math display">\[\begin{equation}
Y_{t}=\beta_{0}+ \beta_{1} P_{t} + \beta_{2} X_{t} + \epsilon_{t}
\hspace{0.5cm} (1) 
\end{equation}\]</span></p>
<p>where <span class="math inline">\(t=1,..,T\)</span> indexes either time or cross-sectional units, <span class="math inline">\(Y_{t}\)</span> is a <span class="math inline">\(k\)</span> x <span class="math inline">\(1\)</span> response variable, <span class="math inline">\(X_{t}\)</span> is a <span class="math inline">\(k\)</span> x <span class="math inline">\(n\)</span> exogenous regressor, <span class="math inline">\(P_{t}\)</span> is a <span class="math inline">\(k\)</span> x <span class="math inline">\(1\)</span> continuous <em>endogenous</em> regressor, <span class="math inline">\(\epsilon_{t}\)</span> is a structural error term with mean zero and <span class="math inline">\(E(\epsilon^{2})=\sigma^{2}_{\epsilon}\)</span>, <span class="math inline">\(\alpha\)</span> and <span class="math inline">\(\beta\)</span> are model parameters. The endogeneity problem arises from the correlation of <span class="math inline">\(P_{t}\)</span> and <span class="math inline">\(\epsilon_{t}\)</span>. As such:</p>
<p><span class="math display">\[\begin{equation}
P_{t}=\gamma Z_{t}+\nu_{t}
\hspace{0.5cm} (2) 
\end{equation}\]</span></p>
<p>where <span class="math inline">\(Z_{t}\)</span> is a <span class="math inline">\(l\)</span> x <span class="math inline">\(1\)</span> vector of internal instrumental variables, and <span class="math inline">\(\nu_{t}\)</span> is a random error with mean zero, <span class="math inline">\(E(\nu^{2})=\sigma^{2}_{\nu}\)</span> and <span class="math inline">\(E(\epsilon\nu)=\sigma_{\epsilon\nu}\)</span>. <span class="math inline">\(Z_{t}\)</span> is assumed to be stochastic with distribution <span class="math inline">\(G\)</span> and <span class="math inline">\(\nu_{t}\)</span> is assumed to have density <span class="math inline">\(h(\cdot)\)</span>.</p>
<p>The <strong>latent instrumental variables</strong> and <strong>the higher moments</strong> models assume <span class="math inline">\(Z_{t}\)</span> to be uncorrelated with the structural error, which is similar to the exclusion restriction assumption for observed instrumental variables methods. Moreover, <span class="math inline">\(Z_{t}\)</span> is also assumed <strong>unobserved</strong>. Therefore, <span class="math inline">\(Z_{t}\)</span> and <span class="math inline">\(\nu_{t}\)</span> cannot be identified without distributional assumptions.</p>
<p>The distributions of <span class="math inline">\(Z_{t}\)</span> and <span class="math inline">\(\nu_{t}\)</span> should be specified such that two conditions are met: <strong>(1)</strong> endogeneity of <span class="math inline">\(P_{t}\)</span> is corrected, and <strong>(2)</strong> the distribution of <span class="math inline">\(P_{t}\)</span> is empirically close to the integral that expresses the amount of overlap of <span class="math inline">\(Z\)</span> as it is shifted over <span class="math inline">\(\nu\)</span> (= the convolution between <span class="math inline">\(Z_{t}\)</span> and <span class="math inline">\(\nu_{t}\)</span>). When the density <span class="math inline">\(h(\cdot)\)</span> is chosen to be normal, then <span class="math inline">\(G\)</span> cannot be normal because the parameters would not be identified (Ebbes et al., 2005). Consequently, in the LIV model the distribution of <span class="math inline">\(Z_{t}\)</span> is discrete while in the higher moments and joint estimation with copulas methods, the distribution of the internal instruments is taken to be skewed.</p>
<div class="section level4">
<h4 id="latent-instrumental-variable-approach">
<em>Latent Instrumental Variable Approach</em><a class="anchor" aria-label="anchor" href="#latent-instrumental-variable-approach"></a>
</h4>
<p>Ebbes et al. (2005) propose the latent instrumental variables approach whose model is described in equations (1) and (2) above. A particular characteristic of this approach is that the internal instrumental variables <span class="math inline">\(Z_{t}\)</span> are assumed <strong>unobserved, discrete and exogenous</strong>, with an unknown number of groups <span class="math inline">\(m\)</span>, while <span class="math inline">\(\gamma\)</span> is a vector of group means.</p>
<p>Identification of the parameters relies on the distributional assumptions of the latent instruments, <span class="math inline">\(Z_{t}\)</span>, as well as that of the endogenous regressor, <span class="math inline">\(P_{t}\)</span>. Specifically:</p>
<ul>
<li>
<span class="math inline">\(P_{t}\)</span> should have a non-Gaussian distribution.</li>
<li>
<span class="math inline">\(Z_{t}\)</span> should be discrete and have at least two groups with different means.</li>
</ul>
<p>A continuous distribution for the instruments leads to an unidentified model, while a normal distribution of the endogenous regressor gives rise to inefficient estimates.</p>
</div>
<div class="section level4">
<h4 id="gaussian-copula-correction-approach">
<em>Gaussian Copula Correction Approach</em><a class="anchor" aria-label="anchor" href="#gaussian-copula-correction-approach"></a>
</h4>
<p>Park and Gupta (2012) propose a method that allows for the joint estimation of the continuous endogenous regressor and the error term using Gaussian copulas (A copula is a function that maps several conditional distribution functions (CDF) into their joint CDF).</p>
<p>The underlying idea is that using information contained in the observed data, one selects marginal distributions for the endogenous regressor and the structural error term, respectively. Then, the copula model enables the construction of a flexible multivariate joint distribution allowing a wide range of correlations between the two marginals.</p>
<p>The method allows both continuous and discrete endogenous regressors. In the case of <strong>one continuous endogenous regressor</strong>, the model is estimated using maximum likelihood. Otherwise, an alternative approach, still based on Gaussian copulas, but using an augmented OLS estimation is being used. The assumption of a skewed endogenous regressor is maintained here as well for the recovery of the correct parameter estimates.</p>
<p>The structural error <span class="math inline">\(\epsilon_{t}\)</span> is assumed to have a normal marginal distribution. The marginal distribution of the endogenous regressor <span class="math inline">\(P_{t}\)</span> is obtained using the Epanechnikov kernel density estimator, as below:</p>
<p><span class="math display">\[\begin{equation}
\label{eqn:6}
\hat{h}(p)=\frac{1}{T\cdot b}\sum_{t=1}^{T}K\left(\frac{p-P_{t}}{b}\right)
\end{equation}\]</span></p>
<p>where <span class="math inline">\(P_{t}\)</span> is the endogenous regressor, <span class="math inline">\(K(x)=0.75\cdot(1-x^{2})\cdot I(\|x\|&lt;=1)\)</span> and the bandwidth <span class="math inline">\(b\)</span> is equal to <span class="math inline">\(b=0.9\cdot T^{-1/5}\cdot min(s,IQR/1.34)\)</span>, as proposed by Silvermann (1969). <span class="math inline">\(IQR\)</span> is the interquartile range while <span class="math inline">\(s\)</span> is the data sample standard deviation and <span class="math inline">\(T\)</span> is the number of time periods observed in the data. In both cases, augmented OLS and maximum likelihood, the inference procedure occurs in two stages (first the empirical distribution of the endogenous regressor is computed and then used in constructing the likelihood function), the standard errors are not correct. Therefore, in both cases, the standard errors and the confidence intervals are obtained based on the sampling distributions resulted from bootstrapping. Since the distribution of the bootstraped parameters is highly skewed, we report the percentile confidence intervals. The variance-covariance matrix is also computed based on the bootstraped parameters, and not based on the Hessian.</p>
<p>In both cases, maximum likelihood estimation and augmented OLS, the reported standard errors are the bootstrapped standard errors, due to the inference being done in two steps. The confidence intervals are also the bootstrapped confidence intervals, due to the non-normality of the bootstrapped parameters.</p>
</div>
<div class="section level4">
<h4 id="higher-moments-approach">
<em>Higher Moments Approach</em><a class="anchor" aria-label="anchor" href="#higher-moments-approach"></a>
</h4>
<p>The higher moments approach proposed by Lewbel (1997) helps identify structural parameters in regression models with endogeneity caused by <em>measurement error</em>. Identification is achieved by exploiting third moments of the data, with no restrictions imposed on the distribution of the error terms.</p>
<p>The following instruments are constructed and can be used with two-stage least squares estimation to obtain consistent estimates:</p>
<p><span class="math display">\[\begin{equation}
\begin{aligned}
q_{1t} &amp;=(G_{t} - \bar{G})  \hspace{1.98cm} (3a)\\ 
q_{2t}&amp;=(G_{t} - \bar{G})(P_{t}-\bar{P})  \hspace{0.6cm} (3b) \\
q_{3t}&amp;=(G_{t} - \bar{G})(Y_{t}-\bar{Y})  \hspace{0.65cm} (3c)\\
q_{4t}&amp;=(Y_{t} - \bar{Y})(P_{t}-\bar{P})  \hspace{0.7cm} (3d)\\
q_{5t}&amp;=(P_{t}- \bar{P})^{2}  \hspace{1.9cm} (3e)\\
q_{6t}&amp;=(Y_{t} - \bar{Y})^{2}  \hspace{1.90cm} (3f)
\end{aligned}
\end{equation}\]</span></p>
<p>Here, <span class="math inline">\(G_{t}=G(X_{t})\)</span> for any given function <span class="math inline">\(G\)</span> that has finite third own and cross moments and <span class="math inline">\(X\)</span> are all the exogenous in the model. <span class="math inline">\(\bar{G}\)</span> is the sample mean of <span class="math inline">\(G_{t}\)</span>. The same rule applies also for <span class="math inline">\(P_{t}\)</span> and <span class="math inline">\(Y_{t}\)</span>.</p>
<p>The instruments in equations (3e) and (3f) can be used only when the measurement and the structural errors are symmetrically distributed. Otherwise, the use of the instruments does not require any distributional assumptions for the errors. Given that the regressors <span class="math inline">\(G(X)=X\)</span> are included as instruments, <span class="math inline">\(G(X)\)</span> should not be linear in <span class="math inline">\(X\)</span> in equation (3a) above.</p>
<p>Since the constructed instruments come along with very strong assumptions, one of their best uses is to provide over-identifying information. The over-identification can be used to test validity of a potential outside instrument, to increase efficiency, and to check for robustness of parameter estimates based on alternative identifying assumptions (Lewbel 1997).</p>
</div>
<div class="section level4">
<h4 id="heteroskedastic-errors-approach">
<em>Heteroskedastic Errors Approach</em><a class="anchor" aria-label="anchor" href="#heteroskedastic-errors-approach"></a>
</h4>
<p>The heteroskedastic errors method identifies structural parameters in regression models with endogenous regressors by means of variables that are uncorrelated with the product of heteroskedastic errors. The instruments are constructed as simple functions of the model’s data. The method can be applied when no external instruments are available or to supplement external instruments to improve the efficiency of the IV estimator (Lewbel, 2012).</p>
<p>Consider the model in equations (1) and (2). This approach assumes that:</p>
<ul>
<li><span class="math inline">\(E(X\epsilon)=0\)</span></li>
<li><span class="math inline">\(E(X\nu)=0\)</span></li>
<li>
<span class="math inline">\(cov(Z,\epsilon\nu)=0\)</span>.</li>
<li>the errors, <span class="math inline">\(\epsilon\)</span> and <span class="math inline">\(\nu\)</span>, may be correlated with each other.</li>
</ul>
<p>Structural parameters are identified by an ordinary two stage least squares regression of <span class="math inline">\(Y\)</span> on <span class="math inline">\(X\)</span> and <span class="math inline">\(P\)</span>, using <span class="math inline">\(X\)</span> and <span class="math inline">\([Z-E(Z)]\nu\)</span> as instruments. A vital assumption for identification is that <span class="math inline">\(cov(Z,\nu^2) \neq 0\)</span>.</p>
<p>The strength of the instrument is proportional to the covariance between <span class="math inline">\((Z-\bar{Z}) \nu\)</span> and <span class="math inline">\(\nu\)</span>, which corresponds to the degree of heteroskedasticity of <span class="math inline">\(\nu\)</span> with respect to <span class="math inline">\(Z\)</span> (Lewbel, 2012). This assumption can be empirically tested. If it is zero or close to zero, the instrument is weak, producing imprecise estimates, with large standard errors. Under homoskedasticity, the parameters of the model are unidentified. But, identification is achieved in the presence of heteroskedasticity related to at least some elements of <span class="math inline">\(X\)</span>.</p>
</div>
</div>
<div class="section level3">
<h3 id="instrument-free-methods-for-hierarchical-data-not-cross-classified">2.2 Instrument Free Methods for Hierarchical Data (not cross-classified)<a class="anchor" aria-label="anchor" href="#instrument-free-methods-for-hierarchical-data-not-cross-classified"></a>
</h3>
<p>Like in single-level regression, also in multilevel models endogeneity is a concern. The additional problem is that in multilevel models there are multiple independent assumptions involving various random components at different levels. Any moderate correlation between some predictors and a random component or error term can result in a significant bias of the coefficients and of the variance components.</p>
<p>Exploiting the hierarchical structure of multilevel data, Kim and Frees (2007) propose a generalized method of moments technique for addressing endogeneity in multilevel models without the need of external instrumental variables. This approach uses both, the between and within variations of the exogenous variables, but only assumes the within variation of the variables to be endogenous.</p>
<p>The model comes with a set of assumptions such as:</p>
<ul>
<li>the errors at each level are normally distributed and independent of each other.</li>
<li>the slope variables are exogenous.<br>
</li>
<li>the level-1 structural error is uncorrelated with any of the regressors.</li>
</ul>
<p>If the last assumption is not met, additional, external instruments are necessary.</p>
<p>Consider a hierarchical model with three levels like below: <span class="math display">\[
\begin{aligned}
 y_{cst} &amp;= Z^{1}_{cst} \beta^{1}_{cs} + X^{1}_{cst} \beta_{1} +\epsilon^{1}_{cst} \\ 
 \beta^{1}_{cs} &amp;= Z^{2}_{cs} \beta^{2}_{c} + X^{2}_{cs} \beta_{2} +\epsilon^{2}_{cs} \\
 \beta^{2}_{c} &amp;= X^{3}_{c} \beta_{3} +\epsilon^{3}_{c}.
\end{aligned}
\]</span></p>
<p>Given the set of disturbance terms at different levels, there exist a couple of possible correlation patterns that could lead to biased results:</p>
<ul>
<li>errors at the higher two levels (<span class="math inline">\(\epsilon^{2}_{cs}\)</span> and <span class="math inline">\(\epsilon^{3}_{c}\)</span>) are correlated with some of the regressors,</li>
<li>only third level errors (<span class="math inline">\(\epsilon^{3}_{c}\)</span>) are correlated with some of the regressors,</li>
<li>an intermediate case, where there is concern with the higher level errors, but there is not enough information to estimate level 3 parameters.</li>
</ul>
<p>The ingenious approach proposed by Kim and Frees (2007) lies in the fact that when all variables are assumed exogenous, the proposed estimator equals the random effects estimator. When all covariates are assumed endogenous, it equals the fixed effects estimator.</p>
<p>In facilitating the choice of the estimator to be used for the given data, Kim and Frees (2007) also propose an omitted variable test (which is reported by the summary function after the estimation using multilevelIV() function in <strong>REndo</strong>). This test is based on the Hausman-test (Hausman, 1978) for panel data. The omitted variable test allows the comparison of a robust estimator and an estimator that is efficient under the null hypothesis of no omitted variables, and also the comparison of two robust estimators at different levels.</p>
</div>
</div>
<div class="section level2">
<h2 id="using-rendo">3. Using <strong>REndo</strong><a class="anchor" aria-label="anchor" href="#using-rendo"></a>
</h2>
<p><strong>REndo</strong> encompasses five functions that allow the estimation of linear models with one or more endogenous regressors using internal instrumental variables. Depending on the assumptions of the model and the structure of the data, single or multilevel, the researcher can use one of the following functions:</p>
<ol style="list-style-type: decimal">
<li>
<p><strong>latentIV()</strong> - implements the latent instrumental variable estimation as in Ebbes (2005). The endogenous variable is assumed to have two components - a latent, discrete and exogenous component with an unknown number of groups and the error term that is assumed normally distributed and correlated with the structural error. The method supports only one endogenous, continuous regressor and no additional explanatory variables. The <strong>latent instrumental variable</strong> function has the following syntax:</p>
<pre><code><span>         <span class="fu"><a href="../reference/latentIV.html">latentIV</a></span><span class="op">(</span><span class="va">y</span> <span class="op">~</span> <span class="va">P</span>, <span class="va">data</span>, start.params<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span> </span></code></pre>
</li>
</ol>
<p>The first argument is the formula of the model to be estimated, <strong>y ~ P</strong>, where <strong>y</strong> is the response and <strong>P</strong> is the endogenous regressor. The second argument is the name of the dataset used and the last one, <strong>start.params=c()</strong>, which is optional, is a vector with the initial parameter values. When not indicated, the initial parameter values are taken to be the coefficients returned by the OLS estimator of <strong>y</strong> on <strong>P</strong>.</p>
<ol start="2" style="list-style-type: decimal">
<li>
<strong>copulaCorrection()</strong> - models the correlation between the endogenous regressor and the structural error with the use of Gaussian copula (Park and Gupta, 2012). The endogenous regressor can be continuous or discrete. The method also allows estimating a model with more than one endogenous regressor, either continuous, discrete or a mixture of the two. However, the endogenous regressors cannot have a binomial distribution, due to parameter identification problems.</li>
</ol>
<p>In the case of only one, continuous endogenous regressor, the method uses maximum likelihood estimation. In the case of a discrete endogenous regressor, or when several endogenous regressors are suspected, the estimation is carried out using an augmented OLS estimation which is nonetheless based on Gaussian copulas.</p>
<p>The <strong>copula correction</strong> function has the following syntax:</p>
<pre><code><span>            <span class="fu"><a href="../reference/copulaCorrection.html">copulaCorrection</a></span><span class="op">(</span> <span class="va">y</span> <span class="op">~</span> <span class="va">X1</span> <span class="op">+</span> <span class="va">X2</span> <span class="op">+</span> <span class="va">P1</span> <span class="op">+</span> <span class="va">P2</span> <span class="op">|</span> <span class="fu">continuous</span><span class="op">(</span><span class="va">P1</span><span class="op">)</span> <span class="op">+</span> <span class="fu">discrete</span><span class="op">(</span><span class="va">P2</span><span class="op">)</span>, </span>
<span>            <span class="va">data</span>, start.params<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="op">)</span>, num.boots<span class="op">=</span><span class="fl">10</span>, optimx.args<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span></span>
<span>    </span></code></pre>
<p>The first argument is a two-part formula of the model to be estimated, with the second part of the RHS defining the endogenous regressor, here <strong>continuous(P1) + discrete(P2)</strong>. The second argument is the name of the data, the third argument of the function, <strong>start.params</strong>, is optional and represents the initial parameter values supplied by the user (when missing, the OLS estimates are considered); the fourth argument, <strong>num.boots</strong>, also optional, is the number of bootstraps to be performed (the default is 1000). The fifth argument,<strong>optimx.args</strong>, is used in order to choose the optimization algorithm and the maximum number of iterations for the selected algorithm. The default is the Nelder-Mead algorithm with 100.000 iterations. Transformation of explanatory variables, such as I(X), ln(X) are supported. The standard errors reported are obtained through bootstrapping, sice in both cases, the inference is done in two stages. Due to the skewness of the bootstrapped parameters, the confidence intervals reported are the percentile confidence intervals. The variance-covariance matrix is also based on the boostrapped values.</p>
<ol start="3" style="list-style-type: decimal">
<li>
<strong>higherMomentsIV()</strong> - implements the higher moments approach described in Lewbel (1997) where instruments are constructed by exploiting higher moments of the data, under strong model assumptions. The function allows just one endogenous regressor.</li>
</ol>
<p>The <strong>higherMomentsIV()</strong> function has a four-part formula, with the following specification:</p>
<pre><code><span>            <span class="fu"><a href="../reference/higherMomentsIV.html">higherMomentsIV</a></span><span class="op">(</span><span class="va">y</span> <span class="op">~</span> <span class="va">X1</span> <span class="op">+</span> <span class="va">X2</span> <span class="op">+</span> <span class="va">P</span> <span class="op">|</span> <span class="va">P</span> <span class="op">|</span> <span class="fu">IIV</span> <span class="op">(</span>iiv <span class="op">=</span> <span class="va">gp</span> , g<span class="op">=</span> <span class="va">x2</span>, <span class="va">X1</span>, <span class="va">X2</span><span class="op">)</span> <span class="op">+</span> </span>
<span>            <span class="fu">IIV</span> <span class="op">(</span>iiv <span class="op">=</span> <span class="va">yp</span><span class="op">)</span> <span class="op">|</span> <span class="va">Z1</span>, <span class="va">data</span><span class="op">)</span></span></code></pre>
<p>where: <strong>y</strong> is the response; the first RHS of the formula, <strong>X1 + X2 + P</strong>, is the model to be estimated; the second part, <strong>P</strong>, specifies the endogenous regressors; the third part, <strong>IIV()</strong>, specifies the format of the internal instruments; the fourth part, <strong>Z1</strong>, is optional, allowing the user to add any external instruments available.</p>
<p>Regarding the third part of the formula, <strong>IIV()</strong>, it has a set of three arguments:</p>
<ul>
<li>
<strong>iiv</strong> - specifies the form of the instrument,</li>
<li>
<strong>g</strong> - specifies the transformation to be done on the exogenous regressors,</li>
<li>the set of exogenous variables from which the internal instruments should be built (any subset of the exogenous variables).</li>
</ul>
<p>A set of six instruments can be constructed, which should be specified in the <strong>iiv</strong> argument of <strong>IIV()</strong>:</p>
<ul>
<li>
<strong>g</strong> - for <span class="math inline">\((G_{t} - \bar{G})\)</span>,</li>
<li>
<strong>gp</strong> - for <span class="math inline">\((G_{t} - \bar{G})(P_{t}-\bar{P})\)</span>,</li>
<li>
<strong>gy</strong> - for <span class="math inline">\((G_{t} - \bar{G})(Y_{t}-\bar{Y})\)</span>,</li>
<li>
<strong>yp</strong> - for <span class="math inline">\((Y_{t} - \bar{Y})(P_{t}-\bar{P})\)</span>,</li>
<li>
<strong>p2</strong> - for <span class="math inline">\((P_{t} - \bar{P})^2\)</span>,</li>
<li>
<strong>y2</strong> - for <span class="math inline">\((Y_{t} - \bar{Y})^2\)</span>,</li>
</ul>
<p>where <span class="math inline">\(G=G(X_{t})\)</span> can be either <span class="math inline">\(x^2\)</span>, <span class="math inline">\(x^3\)</span>, <span class="math inline">\(ln(x)\)</span> or <span class="math inline">\(1/x\)</span> and should be specified in the <strong>g</strong> argument of the third RHD of the formula, as <strong>x2, x3, lnx</strong> or <strong>1/x</strong>. In case of internal instruments built only from the endogenous regressor, e.g. <strong>p2</strong>, or from the response and the endogenous regressor, like for example in <strong>yp</strong>, there is no need to specify <strong>g</strong> or the set of exogenous regressors in the <strong>IIV()</strong> part of the formula. The function returns a set of tests for checking the validity of the instruments and the endogeneity assumption. Here as well, transformation of explanatory variables, such as I(X), ln(X), are supported.</p>
<ol start="4" style="list-style-type: decimal">
<li>
<strong>hetErrorsIV()</strong> - uses the heteroskedasticity of the errors in a linear projection of the endogenous regressor on the other covariates to solve the endogeneity problem induced by measurement error, as proposed by Lewbel (2012). The function allows just one endogenous regressor.</li>
</ol>
<p>The function <strong>hetErrorsIV()</strong> has a four-part formula specification:</p>
<pre><code><span>            <span class="fu"><a href="../reference/hetErrorsIV.html">hetErrorsIV</a></span><span class="op">(</span><span class="va">y</span> <span class="op">~</span> <span class="va">X1</span> <span class="op">+</span> <span class="va">X2</span> <span class="op">+</span> <span class="va">X3</span> <span class="op">+</span> <span class="va">P</span> <span class="op">|</span> <span class="va">P</span> <span class="op">|</span> <span class="fu">IIV</span><span class="op">(</span><span class="va">X1</span>,<span class="va">X2</span><span class="op">)</span> <span class="op">|</span> <span class="va">Z1</span>, <span class="va">data</span><span class="op">)</span></span></code></pre>
<p>where: <strong>y</strong> is the response variable, <strong>X1 + X2 + X3 + P</strong> represents the model to be estimated; the second part, <strong>P</strong>, specifies the endogenous regressors, the third part, <strong>IIV(X1, X2)</strong>, specifies the exogenous heteroskedastic variables from which the instruments are derived, while the final part <strong>Z1</strong> is optional, allowing the user to include additional external instrumental variables. Like in the higher moments approach, allowing the inclusion of additional external variables is a convenient feature of the function, since it increases the efficiency of the estimates. Transformation of the explanatory variables, such as I(X), ln(X) are possible both in the model specification as well as in the IIV() specification.</p>
<ol start="5" style="list-style-type: decimal">
<li>
<strong>multilevelIV()</strong> - implements the instrument free multilevel GMM method proposed by Kim and Frees (2007) where identification is possible due to the different levels of the data. Endogenous regressors at different levels can be present. The function comes along a built in omitted variable test, which helps in deciding which model is robust to omitted variables at different levels.</li>
</ol>
<p>The <strong>multilevelIV()</strong> function allows the estimation of a multilevel model with up to three levels, and it has a syntax in the spirit of the <strong>lmer()</strong> function:</p>
<pre><code><span>            <span class="fu"><a href="../reference/multilevelIV.html">multilevelIV</a></span><span class="op">(</span><span class="va">y</span> <span class="op">~</span> <span class="va">X11</span> <span class="op">+</span> <span class="va">X12</span> <span class="op">+</span> <span class="va">X21</span> <span class="op">+</span> <span class="va">X22</span> <span class="op">+</span> <span class="va">X23</span> <span class="op">+</span> <span class="va">X31</span> <span class="op">+</span> <span class="va">X33</span> <span class="op">+</span> <span class="va">X34</span> <span class="op">+</span> </span>
<span>            <span class="op">(</span><span class="fl">1</span><span class="op">|</span><span class="va">CID</span><span class="op">)</span> <span class="op">+</span> <span class="op">(</span><span class="fl">1</span><span class="op">|</span><span class="va">SID</span><span class="op">)</span> <span class="op">|</span> <span class="fu">endo</span><span class="op">(</span><span class="va">X12</span><span class="op">)</span>, <span class="va">data</span>, lmer.control <span class="op">=</span> <span class="fu">lmerControl</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span><span class="op">)</span>  </span></code></pre>
<p>The call has a two-part formula and an argument for data specification. In the formula, the first part is the model specification, with fixed and random parameter specification, and the second part which specifies the regressors assumed endogenous, here <strong>X12</strong>. The function returns the parameter estimates obtained with fixed effects, random effects and the GMM estimator proposed by Kim and Frees (2007), such that a comparison across models can be done. The user has the possibility to choose the optimization algorithm by specifying it in the <strong>lmer.control</strong> argument. The default is the Nelder Mead algorithm.</p>
</div>
<div class="section level2">
<h2 id="examples-using-real-data">4. Examples using Real Data<a class="anchor" aria-label="anchor" href="#examples-using-real-data"></a>
</h2>
<p>Using the publicly available dataset CASchools which comes with the <strong>AER</strong> package, the results of implementing the instrument-free methods are presented.</p>
<p>The data contain information on test performance, school characteristics and student demographic backgrounds for schools in different districts in California. The data are aggregated at the district level, across different California counties. In trying to answer the question of how does <strong>student/teacher ratio affects the average reading score</strong>, we use as covariates the following variables:</p>
<ul>
<li>student/teacher ratio (students/teachers),</li>
<li>lunch (percent qualifying for reduced-price lunch),</li>
<li>english(percent of English learners),</li>
<li>calworks(percent qualifying for income assistance),</li>
<li>income(district average income in USD 1.000),</li>
<li>grades (a dummy variable if the grade is equal to KK-08)</li>
<li>county (dummy for county).</li>
</ul>
<p>The student/teacher ratio might be endogenous here since it could be correlated with unobserved factors such as teacher salaries or teacher working conditions, which are both unobserved, but can affect the reading score of the students. Having access to an additional variable, namely <strong>expenditure</strong> (the expenditure per student aggregated at district level), we can use it as external instrumental variable. This is possible since it is correlated with the student/teacher ratio (a correlation of <span class="math inline">\(-0.61\)</span>), but does not directly explain the reading score tests of the students. Therefore, we can apply both external(two-stage least squares) and internal instrumental variables techniques to estimate the model and compare their performance.</p>
<p>In orde to have a reference point, we apply OLS on the above data:</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va">AER</span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/mmeierer/REndo" class="external-link">REndo</a></span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">421</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="st">"CASchools"</span><span class="op">)</span></span>
<span><span class="va">school</span> <span class="op">&lt;-</span> <span class="va">CASchools</span></span>
<span><span class="va">school</span><span class="op">$</span><span class="va">stratio</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/with.html" class="external-link">with</a></span><span class="op">(</span><span class="va">CASchools</span>, <span class="va">students</span><span class="op">/</span><span class="va">teachers</span><span class="op">)</span></span>
<span></span>
<span><span class="va">m1.ols</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/lm.html" class="external-link">lm</a></span><span class="op">(</span><span class="va">read</span> <span class="op">~</span> <span class="va">stratio</span> <span class="op">+</span>  <span class="va">english</span> <span class="op">+</span> <span class="va">lunch</span> <span class="op">+</span> <span class="va">grades</span> <span class="op">+</span> <span class="va">income</span> <span class="op">+</span> <span class="va">calworks</span> <span class="op">+</span> <span class="va">county</span>,</span>
<span>             data<span class="op">=</span><span class="va">school</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">m1.ols</span><span class="op">)</span><span class="op">$</span><span class="va">coefficients</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">7</span>,<span class="op">]</span></span>
<span><span class="co">#&gt;                 Estimate Std. Error     t value      Pr(&gt;|t|)</span></span>
<span><span class="co">#&gt; (Intercept) 683.45305948 9.56214469  71.4748711 3.011667e-218</span></span>
<span><span class="co">#&gt; stratio      -0.30035544 0.25797023  -1.1643027  2.450536e-01</span></span>
<span><span class="co">#&gt; english      -0.20550107 0.03765408  -5.4576041  8.871666e-08</span></span>
<span><span class="co">#&gt; lunch        -0.38684059 0.03700982 -10.4523759  1.427370e-22</span></span>
<span><span class="co">#&gt; gradesKK-08  -1.91291321 1.35865394  -1.4079474  1.599886e-01</span></span>
<span><span class="co">#&gt; income        0.71615378 0.09832843   7.2832829  1.986712e-12</span></span>
<span><span class="co">#&gt; calworks     -0.05273312 0.06154758  -0.8567863  3.921191e-01</span></span></code></pre></div>
<p>The OLS coefficient estimate for the student/teacher ratio is <strong>-0.30</strong>. Now, using <strong>expenditure</strong> as external IV, we can estimate a two-stage least squares model, using <strong>ivreg()</strong>:</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">m2.2sls</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/AER/man/ivreg.html" class="external-link">ivreg</a></span><span class="op">(</span><span class="va">read</span> <span class="op">~</span> <span class="va">stratio</span> <span class="op">+</span>  <span class="va">english</span> <span class="op">+</span> <span class="va">lunch</span> <span class="op">+</span> <span class="va">grades</span> <span class="op">+</span> <span class="va">income</span> <span class="op">+</span> <span class="va">calworks</span> <span class="op">+</span> </span>
<span>           <span class="va">county</span><span class="op">|</span> <span class="va">expenditure</span> <span class="op">+</span>  <span class="va">english</span> <span class="op">+</span> <span class="va">lunch</span> <span class="op">+</span> <span class="va">grades</span> <span class="op">+</span> <span class="va">income</span> <span class="op">+</span> <span class="va">calworks</span> <span class="op">+</span> </span>
<span>           <span class="va">county</span> , data<span class="op">=</span><span class="va">school</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">m2.2sls</span><span class="op">)</span><span class="op">$</span><span class="va">coefficients</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">7</span>,<span class="op">]</span></span>
<span><span class="co">#&gt;                 Estimate  Std. Error     t value      Pr(&gt;|t|)</span></span>
<span><span class="co">#&gt; (Intercept) 700.47891593 13.58064436  51.5792106 8.950497e-171</span></span>
<span><span class="co">#&gt; stratio      -1.13674002  0.53533638  -2.1234126  3.438427e-02</span></span>
<span><span class="co">#&gt; english      -0.21396934  0.03847833  -5.5607753  5.162571e-08</span></span>
<span><span class="co">#&gt; lunch        -0.39384225  0.03773637 -10.4366757  1.621794e-22</span></span>
<span><span class="co">#&gt; gradesKK-08  -1.89227865  1.37791820  -1.3732881  1.704966e-01</span></span>
<span><span class="co">#&gt; income        0.62487986  0.11199008   5.5797785  4.668490e-08</span></span>
<span><span class="co">#&gt; calworks     -0.04950501  0.06244410  -0.7927892  4.284101e-01</span></span></code></pre></div>
<p>The external IV method returns an estimate for the assumed endogenous regressor equal to <strong>-1.13</strong>, very different from the OLS estimate.</p>
<p>Next, we estimate the same model using the instrument-free methods from <strong>REndo</strong>. The <strong>latent instrumental variables</strong> approach will probably return a coefficient very different from the other methods, given that the only regressor allowed is the endogenous one. Let’s see:</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span><span class="va">m3.liv</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/latentIV.html">latentIV</a></span><span class="op">(</span><span class="va">read</span> <span class="op">~</span> <span class="va">stratio</span>, data<span class="op">=</span><span class="va">school</span><span class="op">)</span></span>
<span><span class="co">#&gt; No start parameters were given. The linear model read ~ stratio is fitted to derive them.</span></span>
<span><span class="co">#&gt; The start parameters c((Intercept)=706.449, stratio=-2.621, pi1=19.64, pi2=21.532, theta5=0.5, theta6=1, theta7=0.5, theta8=1) are used for optimization.</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">m3.liv</span><span class="op">)</span><span class="op">$</span><span class="va">coefficients</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">7</span>,<span class="op">]</span></span>
<span><span class="co">#&gt;                   Estimate    Std. Error       z-score     Pr(&gt;|z|)</span></span>
<span><span class="co">#&gt; (Intercept)   6.996014e+02  2.686186e+02  2.604441e+00 9.529597e-03</span></span>
<span><span class="co">#&gt; stratio      -2.272673e+00  1.367757e+01 -1.661605e-01 8.681108e-01</span></span>
<span><span class="co">#&gt; pi1          -4.896363e+01  5.526907e-08 -8.859139e+08 0.000000e+00</span></span>
<span><span class="co">#&gt; pi2           1.963920e+01  9.225351e-02  2.128830e+02 0.000000e+00</span></span>
<span><span class="co">#&gt; theta5       6.939432e-152 3.354672e-160  2.068587e+08 0.000000e+00</span></span>
<span><span class="co">#&gt; theta6        3.787512e+02  4.249457e+01  8.912932e+00 1.541524e-17</span></span>
<span><span class="co">#&gt; theta7       -1.227543e+00  4.885276e+01 -2.512741e-02 9.799653e-01</span></span></code></pre></div>
<p>Indeed, the value returned is equal to <strong>-2.273</strong>. The <strong>latentIV()</strong> function returns, besides the coefficient estimates, also the initial parameter values used in the maximum likelihood optimization and the AIC and BIC. The latter two can also be accessed calling AIC(m3.liv) and BIC(m3.liv). The function also returns the fitted values and the residuals, as well as the confidence interval for the coefficients (the bootstrapped confidence intervals will not be reported here, since we used only 2 bootstraps, and 1000 are needed for reporting standard errors).</p>
<p>Next, we call the <strong>copulaCorrection()</strong> function:</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">110</span><span class="op">)</span></span>
<span><span class="va">m4.cc</span> <span class="op">&lt;-</span>  <span class="fu"><a href="../reference/copulaCorrection.html">copulaCorrection</a></span><span class="op">(</span><span class="va">read</span> <span class="op">~</span>  <span class="va">stratio</span> <span class="op">+</span> <span class="va">english</span> <span class="op">+</span> <span class="va">lunch</span> <span class="op">+</span> <span class="va">calworks</span> <span class="op">+</span></span>
<span>           <span class="va">grades</span> <span class="op">+</span> <span class="va">income</span> <span class="op">+</span> <span class="va">county</span> <span class="op">|</span> <span class="fu">continuous</span><span class="op">(</span><span class="va">stratio</span><span class="op">)</span>, data<span class="op">=</span> <span class="va">school</span>,</span>
<span>           optimx.args <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>method<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Nelder-Mead"</span><span class="op">)</span>, itnmax<span class="op">=</span> <span class="fl">60000</span><span class="op">)</span>,</span>
<span>            num.boots<span class="op">=</span><span class="fl">2</span>, verbose <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span><span class="co">#&gt; Warning: It is recommended to run 1000 or more bootstraps.</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">m4.cc</span><span class="op">)</span><span class="op">$</span><span class="va">coefficients</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">7</span>,<span class="op">]</span></span>
<span><span class="co">#&gt;             Point Estimate   Boots SE Lower Boots CI (95%) Upper Boots CI (95%)</span></span>
<span><span class="co">#&gt; (Intercept)   683.06900891 2.80554212                   NA                   NA</span></span>
<span><span class="co">#&gt; stratio        -0.32434608 0.02075999                   NA                   NA</span></span>
<span><span class="co">#&gt; english        -0.21576110 0.01450666                   NA                   NA</span></span>
<span><span class="co">#&gt; lunch          -0.37087664 0.01902052                   NA                   NA</span></span>
<span><span class="co">#&gt; calworks       -0.05569058 0.02076781                   NA                   NA</span></span>
<span><span class="co">#&gt; gradesKK-08    -1.92286128 0.25684614                   NA                   NA</span></span>
<span><span class="co">#&gt; income          0.73595353 0.04725700                   NA                   NA</span></span></code></pre></div>
<p>The copula correction with one endogenous continuous regressor, estimates the model using maximum likelihood. The optimization algorithm used is the Nelder-Mead, which it is known to converge slowly, so it might happen that sometimes your code will not converge. Therefore, the copulaCorrection() allows the user to specify the desired optimization algorithm (see the optimx() function for a list of vailable options) and also the maximum number of iterations for the optimization algorithm.</p>
<p>In the current case, the algorithm converged, and we see that the coefficient of the student/teacher ratio returned is equal to <strong>-0.38</strong>.</p>
<p>The <strong>heteroskedastic errors</strong> approach returns an estimate of the student/teacher ratio equal to <strong>0.71</strong>, far away from the coefficients returned by the external instrumental variables or even OLS. As Lewbel (2012) underlined, it is often better to use this approach in order to create additional instruments, which together with external ones, could lead to improved efficiency.</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">111</span><span class="op">)</span></span>
<span><span class="va">m5.hetEr</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/hetErrorsIV.html">hetErrorsIV</a></span><span class="op">(</span><span class="va">read</span> <span class="op">~</span> <span class="va">stratio</span> <span class="op">+</span> <span class="va">english</span> <span class="op">+</span> <span class="va">lunch</span> <span class="op">+</span> <span class="va">calworks</span>  <span class="op">+</span> <span class="va">income</span>  <span class="op">+</span></span>
<span>        <span class="va">grades</span><span class="op">+</span> <span class="va">county</span> <span class="op">|</span> <span class="va">stratio</span> <span class="op">|</span> <span class="fu">IIV</span><span class="op">(</span><span class="va">income</span>, <span class="va">english</span><span class="op">)</span>, data<span class="op">=</span><span class="va">school</span><span class="op">)</span></span>
<span><span class="co">#&gt; Warning: A studentized Breusch-Pagan test (stratio ~ english) indicates at a 95%</span></span>
<span><span class="co">#&gt; confidence level that the assumption of heteroscedasticity for the variable is</span></span>
<span><span class="co">#&gt; not satisfied (p-value: 0.2428). The instrument built from it therefore is weak.</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">m5.hetEr</span><span class="op">)</span><span class="op">$</span><span class="va">coefficients</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">7</span>,<span class="op">]</span></span>
<span><span class="co">#&gt;                 Estimate  Std. Error    t value     Pr(&gt;|t|)</span></span>
<span><span class="co">#&gt; (Intercept) 662.78791557 27.90173069 23.7543657 2.380436e-76</span></span>
<span><span class="co">#&gt; stratio       0.71480686  1.31077325  0.5453322 5.858545e-01</span></span>
<span><span class="co">#&gt; english      -0.19522271  0.04057527 -4.8113717 2.188618e-06</span></span>
<span><span class="co">#&gt; lunch        -0.37834232  0.03927793 -9.6324402 9.760809e-20</span></span>
<span><span class="co">#&gt; calworks     -0.05665126  0.06302095 -0.8989273 3.692776e-01</span></span>
<span><span class="co">#&gt; income        0.82693755  0.17236557  4.7975797 2.335271e-06</span></span>
<span><span class="co">#&gt; gradesKK-08  -1.93795843  1.38723186 -1.3969968 1.632541e-01</span></span></code></pre></div>
<p>Last, but not least, <strong>higher moments approach</strong> returns an estimate in the range of the estimate produced by the two-stage least squares and control function methods, namely <strong>-1.30</strong>:</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">112</span><span class="op">)</span></span>
<span><span class="va">m6.highMoment</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/higherMomentsIV.html">higherMomentsIV</a></span><span class="op">(</span><span class="va">read</span> <span class="op">~</span> <span class="va">stratio</span> <span class="op">+</span> <span class="va">english</span> <span class="op">+</span> <span class="va">lunch</span> <span class="op">+</span> <span class="va">calworks</span> <span class="op">+</span> <span class="va">income</span> <span class="op">+</span> </span>
<span>                 <span class="va">grades</span> <span class="op">+</span> <span class="va">county</span><span class="op">|</span> <span class="va">stratio</span> <span class="op">|</span> <span class="fu">IIV</span><span class="op">(</span>g <span class="op">=</span> <span class="va">x3</span>,iiv <span class="op">=</span> <span class="va">gp</span>, <span class="va">income</span><span class="op">)</span>, data<span class="op">=</span><span class="va">school</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">m6.highMoment</span><span class="op">)</span><span class="op">$</span><span class="va">coefficients</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">7</span>,<span class="op">]</span></span>
<span><span class="co">#&gt;                 Estimate  Std. Error    t value     Pr(&gt;|t|)</span></span>
<span><span class="co">#&gt; (Intercept) 703.95605932 56.18284961 12.5297322 2.974075e-30</span></span>
<span><span class="co">#&gt; stratio      -1.30755252  2.73072188 -0.4788304 6.323429e-01</span></span>
<span><span class="co">#&gt; english      -0.21569879  0.04726222 -4.5638738 6.848861e-06</span></span>
<span><span class="co">#&gt; lunch        -0.39527218  0.04409111 -8.9648953 1.576520e-17</span></span>
<span><span class="co">#&gt; calworks     -0.04884574  0.06367608 -0.7670971 4.435143e-01</span></span>
<span><span class="co">#&gt; income        0.60623924  0.31312518  1.9360923 5.361980e-02</span></span>
<span><span class="co">#&gt; gradesKK-08  -1.88806451  1.38805414 -1.3602240 1.745894e-01</span></span></code></pre></div>
<p>The <strong>CASchools</strong> dataset has information at the district level, where the districts are clustered into counties. One could be tempted to apply the multilevel GMM method to these data, as implemented in the <strong>multilevelIV()</strong> function. However, the endogeneity problem solved by the multilevel GMM approach considers only correlations between level-1 variables and level-2 errors, while the endogeneity presented in the example above deals with endogeneity between a level-1 variable and the level-1 error. Therefore, we expect that the <strong>multilevelIIV()</strong> function will indicate the use of <em>fixed effects</em> method. In other words, the results should be similar with the ones returned by OLS since we included county dummy variables. Indeed, the omitted variable test between the fixed effects and the GMM model rejects the null hypothesis, therefore indicating an endogeneity problem at level one and the use of fixed effects.</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span> <span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">113</span><span class="op">)</span></span>
<span> <span class="va">school</span><span class="op">$</span><span class="va">gr08</span> <span class="op">&lt;-</span> <span class="va">school</span><span class="op">$</span><span class="va">grades</span><span class="op">==</span><span class="st">"KK-06"</span></span>
<span> <span class="va">m7.multilevel</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/multilevelIV.html">multilevelIV</a></span><span class="op">(</span><span class="va">read</span> <span class="op">~</span> <span class="va">stratio</span> <span class="op">+</span> <span class="va">english</span> <span class="op">+</span> <span class="va">lunch</span>  <span class="op">+</span> <span class="va">income</span> <span class="op">+</span> <span class="va">gr08</span> <span class="op">+</span> </span>
<span>           <span class="va">calworks</span> <span class="op">+</span> <span class="op">(</span><span class="fl">1</span><span class="op">|</span><span class="va">county</span><span class="op">)</span> <span class="op">|</span> <span class="fu">endo</span><span class="op">(</span><span class="va">stratio</span><span class="op">)</span>, data<span class="op">=</span><span class="va">school</span><span class="op">)</span></span>
<span> <span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">m7.multilevel</span><span class="op">)</span><span class="op">$</span><span class="va">coefficients</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">7</span>,<span class="op">]</span></span>
<span><span class="co">#&gt;                Estimate Std. Error     z-score     Pr(&gt;|z|)</span></span>
<span><span class="co">#&gt; (Intercept) 675.8228656 5.58008680 121.1133248 0.000000e+00</span></span>
<span><span class="co">#&gt; stratio      -0.4956054 0.23922638  -2.0717005 3.829339e-02</span></span>
<span><span class="co">#&gt; english      -0.2599777 0.03413530  -7.6160948 2.614656e-14</span></span>
<span><span class="co">#&gt; lunch        -0.3692954 0.03560210 -10.3728537 3.295342e-25</span></span>
<span><span class="co">#&gt; income        0.6723141 0.08862012   7.5864728 3.287314e-14</span></span>
<span><span class="co">#&gt; gr08TRUE      2.1590333 1.28167222   1.6845440 9.207658e-02</span></span>
<span><span class="co">#&gt; calworks     -0.0570633 0.05711701  -0.9990596 3.177658e-01</span></span></code></pre></div>
<p>However, we can use the simulated data that comes with the package in order to give an example of the workings of the <strong>multilevelIV()</strong> function.</p>
<p>The dataset has five level-1 regressors, X11, X12, X13, X14 and X15, where X15 is correlated with the level two error, thus endogenous. There are four level-2 regressors, X21, X22, X23 and X24, and three level-3 regressors, X31, X32, X33, all exogenous. We estimate a three-level model with X15 assumed endogenous.</p>
<p>Having a three-level hierarchy, <strong>multilevelIV()</strong> returns five estimators, from the most robust to omitted variables (FE_L2), to the most efficient (REF), i.e. lowest mean squared error. The random effects estimator (REF) is efficient assuming no omitted variables, whereas the fixed effects estimator (FE) is unbiased and asymptotically normal even in the presence of omitted variables. Because of the efficiency, one would choose the random effects estimator if confident that no important variables were omitted. On the contrary, the robust estimator would be preferable if there was a concern that important variables were likely to be omitted. The estimation result is below:</p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="va">dataMultilevelIV</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">114</span><span class="op">)</span></span>
<span><span class="va">formula1</span> <span class="op">&lt;-</span> <span class="va">y</span> <span class="op">~</span> <span class="va">X11</span> <span class="op">+</span> <span class="va">X12</span> <span class="op">+</span> <span class="va">X13</span> <span class="op">+</span> <span class="va">X14</span> <span class="op">+</span> <span class="va">X15</span> <span class="op">+</span> <span class="va">X21</span> <span class="op">+</span> <span class="va">X22</span> <span class="op">+</span> <span class="va">X23</span> <span class="op">+</span> <span class="va">X24</span> <span class="op">+</span></span>
<span><span class="va">X31</span> <span class="op">+</span> <span class="va">X32</span> <span class="op">+</span> <span class="va">X33</span> <span class="op">+</span>  <span class="op">(</span><span class="fl">1</span> <span class="op">|</span> <span class="va">CID</span><span class="op">)</span> <span class="op">+</span> <span class="op">(</span><span class="fl">1</span> <span class="op">|</span> <span class="va">SID</span><span class="op">)</span> <span class="op">|</span> <span class="fu">endo</span><span class="op">(</span><span class="va">X15</span><span class="op">)</span></span>
<span><span class="va">m8.multilevel</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/multilevelIV.html">multilevelIV</a></span><span class="op">(</span>formula <span class="op">=</span> <span class="va">formula1</span>, data <span class="op">=</span> <span class="va">dataMultilevelIV</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/stats/coef.html" class="external-link">coef</a></span><span class="op">(</span><span class="va">m8.multilevel</span><span class="op">)</span></span>
<span><span class="co">#&gt;                    REF      FE_L2      FE_L3     GMM_L2     GMM_L3</span></span>
<span><span class="co">#&gt; (Intercept) 64.3168856  0.0000000  0.0000000 64.3485944 64.3168868</span></span>
<span><span class="co">#&gt; X11          3.0213405  3.0459605  3.0214255  3.0146686  3.0213403</span></span>
<span><span class="co">#&gt; X12          8.9522160  8.9839088  8.9524723  8.9747533  8.9522169</span></span>
<span><span class="co">#&gt; X13         -2.0194178 -2.0145054 -2.0193321 -2.0021426 -2.0194171</span></span>
<span><span class="co">#&gt; X14          1.9651420  1.9791437  1.9648317  1.9658681  1.9651421</span></span>
<span><span class="co">#&gt; X15         -0.5647915 -0.9777361 -0.5647621 -0.9750309 -0.5648070</span></span>
<span><span class="co">#&gt; X21         -2.3316225  0.0000000 -2.2845297 -2.3052516 -2.3316215</span></span>
<span><span class="co">#&gt; X22         -3.9564944  0.0000000 -3.9553644 -4.0130975 -3.9564966</span></span>
<span><span class="co">#&gt; X23         -2.9779887  0.0000000 -2.9756848 -2.9488487 -2.9779876</span></span>
<span><span class="co">#&gt; X24          4.9078293  0.0000000  4.9084694  4.7933756  4.9078250</span></span>
<span><span class="co">#&gt; X31          2.1142348  0.0000000  0.0000000  2.1164477  2.1142349</span></span>
<span><span class="co">#&gt; X32          0.3934770  0.0000000  0.0000000  0.3799626  0.3934764</span></span>
<span><span class="co">#&gt; X33          0.1082086  0.0000000  0.0000000  0.1108386  0.1082087</span></span></code></pre></div>
<p>As we have simulated the data, we know that the true parameter value of the endogenous regressor (X15) is <span class="math inline">\(-1\)</span>. Looking at the coefficients of X15 returned by the five models, we see that they form two clusters: one cluster is composed of the level-two fixed effects estimator and the level-two GMM estimator (both return <span class="math inline">\(-0.975\)</span>), while the other cluster is composed of the other three estimators, FE_L3, GMM_L3, REF, all three having a value of <span class="math inline">\(-0.564\)</span>. The bias of the last three estimators is to be expected since we have simulated the data such that X15 is correlated with the level-two error, to which only FE_L2 and GMM_L2 are robust.</p>
<p>To provide guidance for selecting the appropriate estimator, <strong>multilevelIV()</strong> function performs an omitted variable test. The results are returned by the <strong>summary()</strong> function. For example, in a three-level setting, different estimator comparisons are possible:</p>
<ul>
<li>
<strong>Fixed effects versus random effects estimators:</strong> To test for omitted level-two and level-three omitted effects, simultaneously, one compares FE_L2 to REF. The test does not indicate the level at which omitted variables might exist.</li>
<li>
<strong>Fixed effects versus GMM estimators:</strong> Once the existence of omitted effects is established but not certain at which level (see 1), we test for level-two omitted effects by comparing FE_L2 versus GMM_L3. A rejection of the null hypothesis will imply omitted variables at level-two. The same is accomplished by testing FE_L2 versus GMM_L2, since the latter is consistent only if there are no omitted effects at level two.</li>
<li>
<strong>Fixed effects versus fixed effects estimators:</strong> We can test for omitted level-two effects, while allowing for omitted level-three effects. This can be done by comparing FE_L2 versus FE_L3since FE_L2 is robust against both level-two and level-three omitted effects while FE_L3 is only robust to level-three omitted variables.</li>
</ul>
<p>In general, testing for higher level endogeneity in multilevel settings one would start by looking at the results of the omitted variable test comparing REF and FE_L2. If the null hypothesis if rejected, this means the model suffers from omitted variables, either at level two or level three. Next, test whether there are level-two omitted effects, since testing for omitted level three effects relies on the assumption there are no level-two omitted effects. To this end, one can rely on one of the following model comparisons: FE_L2 versus FE_L3 or FE_L2 versus GMM_L2. If no omitted variables at level-two are found, proceed with testing for omitted level-three effects by comparing FE_L3 versus GMM_L3 or GMM_L2 versus GMM_L3.</p>
<p>In order to have a quick overview of the coefficients returned by each of the possible estimation approaches (fixed effects, GMM, random effects), one should use the <strong>coef()</strong> function, with the name of the estimated model as parameter (here m8.multilevel). For a detailed summary of each estimated model, the <strong>summary()</strong> function should be used, which takes two arguments: the name of the model object (here m8.multilevel) and the estimation method (here REF). The second parameter can take the following values, depending on the model estimated (two or three levels): REF, GMM_L2, GMM_L3, FE_L2, FE_L3. It returns the estimated coefficients under the model specified in the second argument, together with their standard errors and z-scores. Further, it returns the chi-squared statistic, degrees of freedom and p-value of the omitted variable test between the focal model (here REF) and all the other possible options (here FE_L3, GMM_L2 and GMM_L3).</p>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">m8.multilevel</span>, <span class="st">"REF"</span><span class="op">)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Call:</span></span>
<span><span class="co">#&gt; multilevelIV(formula = formula1, data = dataMultilevelIV)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Number of levels: 3</span></span>
<span><span class="co">#&gt; Number of observations: 2824</span></span>
<span><span class="co">#&gt; Number of groups: L2(CID): 1368  L3(SID): 40</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Coefficients for model REF:</span></span>
<span><span class="co">#&gt;             Estimate Std. Error z-score Pr(&gt;|z|)    </span></span>
<span><span class="co">#&gt; (Intercept) 64.31689    7.87332   8.169 3.11e-16 ***</span></span>
<span><span class="co">#&gt; X11          3.02134    0.02576 117.306  &lt; 2e-16 ***</span></span>
<span><span class="co">#&gt; X12          8.95222    0.02572 348.131  &lt; 2e-16 ***</span></span>
<span><span class="co">#&gt; X13         -2.01942    0.02409 -83.835  &lt; 2e-16 ***</span></span>
<span><span class="co">#&gt; X14          1.96514    0.02521  77.937  &lt; 2e-16 ***</span></span>
<span><span class="co">#&gt; X15         -0.56479    0.01950 -28.962  &lt; 2e-16 ***</span></span>
<span><span class="co">#&gt; X21         -2.33162    0.16228 -14.368  &lt; 2e-16 ***</span></span>
<span><span class="co">#&gt; X22         -3.95649    0.13119 -30.160  &lt; 2e-16 ***</span></span>
<span><span class="co">#&gt; X23         -2.97799    0.06611 -45.044  &lt; 2e-16 ***</span></span>
<span><span class="co">#&gt; X24          4.90783    0.19796  24.792  &lt; 2e-16 ***</span></span>
<span><span class="co">#&gt; X31          2.11423    0.10433  20.264  &lt; 2e-16 ***</span></span>
<span><span class="co">#&gt; X32          0.39348    0.30426   1.293   0.1959    </span></span>
<span><span class="co">#&gt; X33          0.10821    0.05236   2.067   0.0388 *  </span></span>
<span><span class="co">#&gt; ---</span></span>
<span><span class="co">#&gt; Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Omitted variable tests for model REF:</span></span>
<span><span class="co">#&gt;               df     Chisq  p-value    </span></span>
<span><span class="co">#&gt; GMM_L2_vs_REF  7     18.74 0.009040 ** </span></span>
<span><span class="co">#&gt; GMM_L3_vs_REF 13 -12872.98 1.000000    </span></span>
<span><span class="co">#&gt; FE_L2_vs_REF  13     39.99 0.000139 ***</span></span>
<span><span class="co">#&gt; FE_L3_vs_REF  13     39.99 0.000138 ***</span></span>
<span><span class="co">#&gt; ---</span></span>
<span><span class="co">#&gt; Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1</span></span></code></pre></div>
<p>In the example above, we compare the random effects (REF) with all the other estimators. Testing REF, the most efficient estimator, against the level-two fixed effects estimator, FE_L2, which is the most robust estimator, we are actually testing simultaneously for level-2 and level-3 omitted effects. Since the null hypothesis is rejected with a p-value of <span class="math inline">\(0.000139\)</span>, the test indicates severe bias in the random effects estimator. In order to test for <em>level-two omitted effects regardless of the presence of level-three omitted effects</em>, we have to compare the two fixed effects estimators, FE_L2 versus FE_L3:</p>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">m8.multilevel</span>,<span class="st">"FE_L2"</span><span class="op">)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Call:</span></span>
<span><span class="co">#&gt; multilevelIV(formula = formula1, data = dataMultilevelIV)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Number of levels: 3</span></span>
<span><span class="co">#&gt; Number of observations: 2824</span></span>
<span><span class="co">#&gt; Number of groups: L2(CID): 1368  L3(SID): 40</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Coefficients for model FE_L2:</span></span>
<span><span class="co">#&gt;               Estimate Std. Error z-score Pr(&gt;|z|)    </span></span>
<span><span class="co">#&gt; (Intercept)  0.000e+00  4.275e-19    0.00        1    </span></span>
<span><span class="co">#&gt; X11          3.046e+00  2.978e-02  102.30   &lt;2e-16 ***</span></span>
<span><span class="co">#&gt; X12          8.984e+00  3.360e-02  267.41   &lt;2e-16 ***</span></span>
<span><span class="co">#&gt; X13         -2.015e+00  3.107e-02  -64.83   &lt;2e-16 ***</span></span>
<span><span class="co">#&gt; X14          1.979e+00  3.203e-02   61.80   &lt;2e-16 ***</span></span>
<span><span class="co">#&gt; X15         -9.777e-01  3.364e-02  -29.06   &lt;2e-16 ***</span></span>
<span><span class="co">#&gt; X21          0.000e+00  1.824e-18    0.00        1    </span></span>
<span><span class="co">#&gt; X22          0.000e+00  1.303e-18    0.00        1    </span></span>
<span><span class="co">#&gt; X23          0.000e+00  4.389e-18    0.00        1    </span></span>
<span><span class="co">#&gt; X24          0.000e+00  1.724e-18    0.00        1    </span></span>
<span><span class="co">#&gt; X31          0.000e+00  1.468e-17    0.00        1    </span></span>
<span><span class="co">#&gt; X32          0.000e+00  8.265e-18    0.00        1    </span></span>
<span><span class="co">#&gt; X33          0.000e+00  2.793e-17    0.00        1    </span></span>
<span><span class="co">#&gt; ---</span></span>
<span><span class="co">#&gt; Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Omitted variable tests for model FE_L2:</span></span>
<span><span class="co">#&gt;                 df Chisq  p-value    </span></span>
<span><span class="co">#&gt; FE_L2_vs_REF    13 39.99 0.000139 ***</span></span>
<span><span class="co">#&gt; FE_L2_vs_FE_L3   9 36.02 3.92e-05 ***</span></span>
<span><span class="co">#&gt; FE_L2_vs_GMM_L2 12 39.99 7.21e-05 ***</span></span>
<span><span class="co">#&gt; FE_L2_vs_GMM_L3 13 39.99 0.000139 ***</span></span>
<span><span class="co">#&gt; ---</span></span>
<span><span class="co">#&gt; Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1</span></span></code></pre></div>
<p>The null hypothesis of no omitted level-two effects is rejected (p-value is equal to <span class="math inline">\(3.92e-05\)</span>). Therefore, we conclude that there are omitted effects at level-two. This finding is no surprise as we simulated the dataset with the level-two error correlated with X15, which leads to biased FE_L3 coefficients. The omitted variable test between level-two fixed effects and level-two GMM should shows that the null hypothesis of no omitted level-two effects is rejected (p-value is 0). In case of wrongly assuming that an endogenous variable is exogenous, the random effects as well as the GMM estimators will be biased, since the former will be constructed using the wrong set of internal instrumental variables. Consequently, comparing the results of the omitted variable tests when the variable is considered endogenous versus exogenous can indicate whether the variable is indeed endogenous or not. To conclude this example, the test results provide support that the FE_L2 should be used.</p>
</div>
<div class="section level2">
<h2 id="references">References<a class="anchor" aria-label="anchor" href="#references"></a>
</h2>
<p>Ebbes P, Wedel M, Boeckenholt U, Steerneman A (2005). “Solving and Testing for Regressor- Error (In)Dependence When no Instrumental Variables Are Available: With New Evidence for the Effect of Education on Income.” Quantitative Marketing and Economics, 3(4), 365–392.</p>
<p>Epanechnikov V (1969). “Nonparametric Estimation of a Multidimensional Probability Den- sity.” Teoriya veroyatnostei i ee primeneniya, 14(1), 156–161.</p>
<p>Kim S, Frees F (2007). “Multilevel Modeling with Correlated Effects.” Psychometrika, 72(4), 505–533.</p>
<p>Lewbel A (1997). “Constructing Instruments for Regressions with Measurement Error When No Additional Data are Available, With an Application to Patents and R and D.” Econometrica, 65(5), 1201–1213.</p>
<p>Lewbel A (2012). “Using Heteroscedasticity to Identify and Estimate Mismeasured and En- dogenous Regressor Models.” Journal of Business and Economic Statistics, 30(1), 67–80.</p>
<p>Park S, Gupta S (2012). “Handling Endogeneous Regressors by Joint Estimation Using Cop- ulas.” Marketing Science, 31(4), 567–586.</p>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p></p>
<p>Developed by Raluca Gui, Markus Meierer, Rene Algesheimer, Patrik Schilter.</p>
</div>

<div class="pkgdown">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.5.9000.</p>
</div>

      </footer>
</div>

  


  

  </body>
</html>
